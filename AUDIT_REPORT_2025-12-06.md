# Jessica Core - Code Audit Report
**Date:** December 6, 2025  
**Status:** CRITICAL ISSUES FOUND

## Executive Summary

Jessica Core has **3 critical missing components** that prevent proper startup:
1. Missing `start-jessica.sh` startup script
2. Missing `memory_server.py` (ChromaDB service on port 5001)
3. Missing `whisper_server.py` (speech-to-text service on port 5000)

All three are referenced throughout the codebase but do not exist, causing startup failures.

---

## Critical Issues

### 1. Missing Startup Script (`start-jessica.sh`)
**Severity:** CRITICAL  
**Impact:** No way to start all services together

**Evidence:**
- Referenced in `AGENTS.md` (line 14, 58, 197)
- Referenced in `README.md` (line 128)
- Referenced in `MODEL_SETUP.md`, `DEPLOYMENT.md`, `TROUBLESHOOTING.md`
- File does not exist in repository

**Expected Functionality:**
- Start Ollama service
- Start memory_server.py on port 5001
- Start whisper_server.py on port 5000
- Start jessica_core.py on port 8000
- Load API keys from ~/.bashrc
- Handle service dependencies (Ollama must start first)

---

### 2. Missing Memory Server (`memory_server.py`)
**Severity:** CRITICAL  
**Impact:** Memory storage/recall completely broken

**Evidence:**
- `jessica_core.py` expects service on `http://localhost:5001` (line 64)
- Calls `/store` endpoint (line 929)
- Calls `/recall` endpoint (line 968)
- Calls `/health` endpoint (line 1174)
- File does not exist in repository

**Expected API Endpoints:**
- `POST /store` - Store memory with `{id, text, collection, metadata}`
- `POST /recall` - Search memory with `{query, n}` returns `{documents: [...]}`
- `GET /health` - Health check

**Expected Implementation:**
- ChromaDB vector database
- Store at `~/jessica-memory/`
- Use sentence-transformers for embeddings
- FastAPI or Flask server

---

### 3. Missing Whisper Server (`whisper_server.py`)
**Severity:** CRITICAL  
**Impact:** Voice transcription completely broken

**Evidence:**
- `jessica_core.py` expects service on `http://localhost:5000` (line 63)
- Calls `/transcribe` endpoint (line 1221)
- File does not exist in repository

**Expected API Endpoints:**
- `POST /transcribe` - Accept audio file, return transcription JSON

**Expected Implementation:**
- OpenAI Whisper model (already in requirements.txt as `openai-whisper`)
- FastAPI or Flask server
- File upload handling

---

## Code Quality Issues

### 4. Environment Variable Loading
**Status:** WORKING but could be improved  
**Current:** Uses `python-dotenv` to load `.env` file  
**Issue:** No `.env` file exists, relies on `~/.bashrc` exports

**Recommendation:**
- Create `.env.example` template
- Document that `.env` OR `~/.bashrc` can be used
- Current implementation is fine (load_dotenv() doesn't fail if file missing)

---

### 5. Service Dependency Validation
**Status:** PARTIAL  
**Current:** `/status` endpoint checks services but doesn't prevent startup

**Recommendation:**
- Add startup validation that warns if services aren't available
- Consider making memory/whisper optional (graceful degradation)
- Current behavior is acceptable (services fail gracefully)

---

## Working Components

✅ **jessica_core.py** - Main Flask server is well-structured  
✅ **exceptions.py** - Custom exception classes properly defined  
✅ **retry_utils.py** - Retry logic with exponential backoff  
✅ **requirements.txt** - All dependencies listed (including chromadb, sentence-transformers, openai-whisper)  
✅ **Test infrastructure** - pytest tests exist and show expected API contracts  
✅ **Logging** - Structured logging with request IDs  
✅ **Error handling** - Comprehensive try/catch blocks  

---

## Files to Create

1. **`start-jessica.sh`** - Startup script for all services
2. **`memory_server.py`** - ChromaDB service on port 5001
3. **`whisper_server.py`** - Whisper transcription service on port 5000

---

## Testing Recommendations

After creating missing files:
1. Test startup script starts all services
2. Test memory server stores/recalls correctly
3. Test whisper server transcribes audio
4. Test jessica_core.py connects to all services
5. Test graceful degradation when services unavailable

---

## Priority Fix Order

1. **IMMEDIATE:** Create `memory_server.py` (core functionality)
2. **IMMEDIATE:** Create `whisper_server.py` (voice features)
3. **IMMEDIATE:** Create `start-jessica.sh` (ease of use)
4. **LOW:** Add `.env.example` template (documentation)

---

**Report Generated By:** Factory Droid  
**For:** Corporal Phyre  
**Mission:** Get Jessica operational ASAP

